apiVersion: policy.mcm.ibm.com/v1alpha1
kind: Policy
metadata:
  name: operator-role-policies
  namespace: kube-system
  annotations:
    policy.mcm.ibm.com/standards: NIST,HIPAA
    policy.mcm.ibm.com/categories: SystemAndCommunicationsProtections,SystemAndInformationIntegrity
    policy.mcm.ibm.com/controls: MutationAdvisor,VA
spec:
  remediationAction: "inform" # enforce or inform
  namespaces:
    include: ["default"]
    exclude: ["kube*"]
  role-templates:
    - apiVersion: roletemplate.mcm.ibm.com/v1alpha1
      metadata:
        namespace: "" # will be inferred
        name: operator-role
      selector:
        matchLabels:
          dev: "true"
      complianceType: "musthave" # at this level, it means the role must exist with the rules that it musthave below
      rules:
        - complianceType: "musthave" # at this level, it means if the role exists the rule is a musthave
          policyRule:
            apiGroups: ["extensions", "apps"]
            resources: ["deployments"]
            verbs: ["get", "list", "watch", "create", "delete","patch"]
---
apiVersion: mcm.ibm.com/v1alpha1
kind: PlacementBinding
metadata:
  labels:
    name: multicloud-role-placement-binding
    placementPolicy: production-clusters-placement
  name: multicloud-role-placement-binding
  namespace: kube-system
placementRef:
  apiGroup: policy.mcm.ibm.com
  kind: PlacementPolicy
  name: production-clusters-placement
subjects:
- kind: Policy
  apiGroup: policy.mcm.ibm.com
  name: operator-role-policies
